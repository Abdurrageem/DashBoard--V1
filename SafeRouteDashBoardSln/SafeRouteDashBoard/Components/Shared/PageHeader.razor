@* Reusable Page Header Component *@

<MudStack Spacing="3" Style="margin-bottom: 32px;">
    <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
        <div>
            @if (ShowBackButton)
            {
                <MudIconButton Icon="@Icons.Material.Filled.ArrowBack" 
                              Color="Color.Default" 
                              Href="/"
                              Style="margin-right: 16px;" />
            }
            <MudText Typo="Typo.h4" Style="font-weight: 700; color: #1F2937; display: inline;">
                @Title
            </MudText>
            @if (!string.IsNullOrEmpty(Subtitle))
            {
                <MudText Typo="Typo.body1" Style="color: #6B7280; margin-top: 4px;">
                    @Subtitle
                </MudText>
            }
        </div>
        
        <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center">
            @if (ShowLastUpdate)
            {
                <MudStack AlignItems="AlignItems.End" Spacing="0" Style="margin-right: 16px;">
                    <MudText Typo="Typo.caption" Style="color: #6B7280;">
                        Last updated: @GetUpdateTime()
                    </MudText>
                    @if (IsSyncing)
                    {
                        <MudText Typo="Typo.caption" Style="color: #1F2937; font-weight: 500;">
                            <MudProgressCircular Size="Size.Small" Indeterminate="true" Style="width: 12px; height: 12px; display: inline-block; vertical-align: middle;" />
                            Syncing with mobile app...
                        </MudText>
                    }
                </MudStack>
                <MudIconButton Icon="@Icons.Material.Filled.Refresh" 
                              Color="Color.Default" 
                              OnClick="OnRefresh"
                              Size="Size.Medium"
                              Style="color: #1F2937;" />
            }
            
            @if (ActionButtons != null)
            {
                @ActionButtons
            }
        </MudStack>
    </MudStack>
    
    @if (ShowDivider)
    {
        <MudDivider Style="border-color: #E5E7EB;" />
    }
</MudStack>

@code {
    [Parameter] public string Title { get; set; } = string.Empty;
    [Parameter] public string Subtitle { get; set; } = string.Empty;
    [Parameter] public bool ShowBackButton { get; set; } = false;
    [Parameter] public bool ShowLastUpdate { get; set; } = true;
    [Parameter] public bool ShowDivider { get; set; } = true;
    [Parameter] public DateTime? LastUpdateTime { get; set; }
    [Parameter] public bool IsSyncing { get; set; } = false;
    [Parameter] public EventCallback OnRefresh { get; set; }
    [Parameter] public RenderFragment? ActionButtons { get; set; }

    private string GetUpdateTime()
    {
        if (LastUpdateTime == null) return "Never";
        
        var timeSpan = DateTime.Now - LastUpdateTime.Value;
        
        if (timeSpan.TotalSeconds < 60)
            return $"{(int)timeSpan.TotalSeconds}s ago";
        if (timeSpan.TotalMinutes < 60)
            return $"{(int)timeSpan.TotalMinutes}m ago";
        if (timeSpan.TotalHours < 24)
            return $"{(int)timeSpan.TotalHours}h ago";
        
        return LastUpdateTime.Value.ToString("MMM dd, HH:mm");
    }
}
